# ============================================
# m006: Server-ментор — Docker Compose (Development)
# ============================================

services:
  m006:
    build:
      context: .
      dockerfile: Dockerfile.dev
    container_name: neura-m006-dev
    ports:
      - "${PORT:-3066}:3066"
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    environment:
      - NODE_ENV=development
      - MODULE_ID=m006
      - MODULE_NAME=${MODULE_NAME:-Server-ментор}
      - MODULE_VERSION=${MODULE_VERSION:-1.0.0}
      - PORT=3066
      - CORE_API_URL=${CORE_API_URL:-http://host.docker.internal:8000}
      - MODULE_API_KEY=${MODULE_API_KEY}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - OPENAI_PROMPT_ID=${OPENAI_PROMPT_ID}
      - DATA_PATH=/app/data
      - RUNTIME_CONFIG_PATH=/app/config/runtime.json
      - CONVERSATION_TTL_DAYS=${CONVERSATION_TTL_DAYS:-7}
      - LOG_LEVEL=debug
    volumes:
      # Hot reload
      - ./src:/app/src
      - ./package.json:/app/package.json
      # Фронтенд (hot reload HTML/JS/CSS)
      - ./public:/app/public
      # Данные
      - m006-data-dev:/app/data
      # Runtime конфиг
      - ./config:/app/config
      # Логи вне контейнера
      - ./logs:/app/logs
      # Exclude node_modules
      - /app/node_modules
    networks:
      - neura-network
    restart: unless-stopped

volumes:
  m006-data-dev:
    name: neura-m006-data-dev

networks:
  neura-network:
    name: neura-network
    external: true
